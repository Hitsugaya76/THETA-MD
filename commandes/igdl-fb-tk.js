const {zokou} = require('../framework/zokou');
const fs = require('fs');
const { fetchVideo } = require('@prevter/tiktok-scraper');
 const { writeFileSync } = require('fs');
const mumaker = require("mumaker");
const getFBInfo = require("@xaviabot/fb-downloader");

zokou({nomCom : "igdl" , categorie : "T√©l√©chargement"},async (dest , zk , commandeOptions)=>{
  const {ms,repondre,arg} = commandeOptions ;

  let link = arg.join(' ')

  if (!arg[0]) { repondre('Veillez ins√©rer un lien video instagramme');return}; 

  try {
     const response = await mumaker.instagram(link)
  
  let choix = response[0]

    zk.sendMessage(dest,{video : {url : choix},caption : "t√©l√©chargeur de video ig propuls√© par *Zokou-Md*",gifPlayback : false },{quoted : ms}) 
  } catch (e) {repondre("erreur survenue lors du t√©l√©chargement \n " + e)}

  

  
});


zokou({
  nomCom: "fbdl",
  categorie: "T√©l√©chargement",
  reaction: "üìΩÔ∏è"
},
async (dest, zk, commandeOptions) => {
  const { repondre, ms, arg } = commandeOptions;

  if (!arg[0]) {
    repondre('Veuillez fournir une URL vid√©o publique de Facebook √† t√©l√©charger !');
    return;
  }

  const queryURL = arg.join(" ");

  try {
     getFBInfo(queryURL)
    .then((result) => {
       let caption = `
        titre: ${result.title}
        Lien: ${result.url}
      `;
       zk.sendMessage(dest,{image : { url : result.thumbnail}, caption : caption},{quoted : ms}) ;
       zk.sendMessage(dest, { video: { url: result.hd  }, caption: 'T√©l√©chargeur de vid√©o Facebook, propuls√© par *zokou-MD*' }, { quoted: ms });
      
    })
    .catch((error) => {console.log("Error:", error)
                      repondre(error)});


   
  } catch (error) {
    console.error('Erreur lors du t√©l√©chargement de la vid√©o :', error);
    repondre('Erreur lors du t√©l√©chargement de la vid√©o.' , error);
  }
});



zokou({ nomCom: "tiktok", categorie: "T√©l√©chargement", reaction: "üéµ" }, async (dest, zk, commandeOptions) => {
  const { arg, ms, prefixe,repondre } = commandeOptions;
  if (!arg[0]) {
    repondre(`Voici comment utiliser la commande:\n ${prefixe}veiller lien_video_tiktok`);
    return;
  }

  const videoUrl = arg.join(" ");
  mumaker.tiktok(videoUrl)
    .then((data) => {
      const thumbnail = data.thumbnail;
      const author = data.author;
      const description = data.description;
      const media = Array.isArray(data.media) ? data.media.join(", ") : data.media;
      const music = data.music;
      const like = data.like;
      const comment = data.comment;
      const share = data.share;

      // Envoi du message avec le thumbnail de la vid√©o
      const caption = `
        Auteur: ${author}
        Description: ${description}
        M√©dia: ${media}
        Musique: ${music}
        J'aime: ${like}
        Commentaire: ${comment}
        Partages: ${share}
      `;

      
      zk.sendMessage(dest, { image: { url: thumbnail }, caption: caption},{quoted : ms});

      // Envoi de la vid√©o sans commentaire
      zk.sendMessage(dest, { video: { url: data.media } });

      // Envoi des autres informations
      
    })
    .catch((err) => {
      console.error("Une erreur s'est produite :", err);
    });
});

zokou({
  nomCom: "fbdl2",
  categorie: "T√©l√©chargement",
  reaction: "üìΩÔ∏è"
},
async (dest, zk, commandeOptions) => {
  const { repondre, ms, arg } = commandeOptions;

  if (!arg[0]) {
    repondre('Veuillez fournir une URL vid√©o publique de Facebook √† t√©l√©charger !');
    return;
  }

  const queryURL = arg.join(" ");

  try {
     getFBInfo(queryURL)
    .then((result) => {
       let caption = `
        titre: ${result.title}
        Lien: ${result.url}
      `;
       zk.sendMessage(dest,{image : { url : result.thumbnail}, caption : caption},{quoted : ms}) ;
       zk.sendMessage(dest, { video: { url: result.sd  }, caption: 'T√©l√©chargeur de vid√©o Facebook, propuls√© par *zokou-MD*' }, { quoted: ms });
      
    })
    .catch((error) => {console.log("Error:", error)
                      repondre(error)});


   
  } catch (error) {
    console.error('Erreur lors du t√©l√©chargement de la vid√©o :', error);
    repondre('Erreur lors du t√©l√©chargement de la vid√©o.' , error);
  }
});
